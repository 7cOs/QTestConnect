<head>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">	
	<script type="text/javascript" src="/styles.js"></script>
	
	<script type="text/javascript">
		var d, doc, ci;
		
		var data = {
			header: {
				ico: 'fa fa-database w3-xxlarge',
				_title: 'QTestConn',
				desc: 'aufklären #: 2575 - observieren',
				actions: [{
					id: 'ico_DisplayNav',
					ico: 'fa fa-navicon w3-xlarge'
				}]
			},
			navigator: {
				header: {
					ico: 'fa fa-navicon w3-large'
				},
				actions:[{
					id: 'expand_all',
					ico: 'fa fa-plus',
					type: 'nav_action',
					desc: 'Expand All'
				},{
					id: 'collapse_all',
					ico: 'fa fa-minus',
					type: 'nav_action',
					desc:'Collapse All'
				},{
					id: 'nav_search',
					ico: 'fa fa-search',
					type: 'nav_action',
					desc: 'Search'
				}]
			},
			actionSeparator: '&nbsp;&nbsp;|&nbsp;&nbsp;',
			footer: {
				company: 'rege-it solutions, professional llc &copy;7012'
			}
		};
		
		window.onload = function() { init(); };
	
		function addCi() {
			ci = d.head.parentNode.insertBefore(d.head.parentNode.add('ci'), d.body);
			// ci.hide();
			
			ci.id = 'ci'; 
			ci.add('layout');
			ci.q('layout').add('header').add('quadrants');
			ci.q('layout header quadrants').add('quadrant').id = 'header';
			ci.q('layout header quadrants quadrant').add('ico').className = data.header.ico;
			ci.q('layout header quadrants quadrant').add('_title').htm(data.header._title);
			ci.q('layout header quadrants quadrant').add('desc').htm(data.header.desc);
			ci.q('layout header quadrants').add('quadrant').add('actions');
			ci.q('layout header quadrants quadrant actions').progen.id = 'actions';
			var acts = ci.q('layout header quadrants quadrant actions');
			data.header.actions.forEach( function(o) {
				var act = acts.add('action');
				act.add('ico').className = o.ico;
				act.q('ico').id = o.id;
			});
			
			ci.q('layout').add('main');
			ci.q('layout main').add('actions').add('quadrants').htm('actions-quadrants');
			ci.q('layout main').add('quadrant');
			ci.q('layout main quadrant').add('contents').add('quadrants').htm('contents-quadrants');
			ci.q('layout main quadrant').add('navigator').add('quadrants').htm('navigator-quadrants');
			ci.q('layout').add('_progress').add('quadrants').htm('progress-quadrants');
			ci.q('layout').add('footer').add('quadrants').htm('footer-quadrants');

			//ci.q('layout header quadrants').add('quadrant').id = 'header';
			//ci.q('layout contents header quadrants').add('quadrant').id = 'actions';
			/*
			var qd = ci.q('layout contents header quadrants #header');
			qd.add('contents').add('ico').className = data.header.ico;
			qd.q('contents').add('_title').htm(data.header._title);
			qd.q('contents').add('desc').htm(data.header.desc);
			// - Add header actions - //
			data.header.actions.forEach( function(o) {
				var act = ci.q('layout contents header quadrants #actions').add('action');
				act.add('ico').className = o.ico;
				act.q('ico').id = o.id;
			});
			ci.q('layout contents').add('quadrants');
			
			ci.q('layout contents').add('_progress').add('contents').txt('progress');
			
			ci.q('layout contents').add('footer').add('contents');
			ci.q('layout contents footer contents').htm(data.footer.company);
			
			/*
			ci.q('layout').add('contents').add('header').add('contents');
			ci.q('layout contents header contents').add('_title').txt(data.header._title);
			// - Insert header icon - //
			ci.q('layout contents header contents _title').insertBefore(
					ci.q('layout contents header contents _title').add('ico'),
						ci.q('layout contents header contents _title').firstChild);
			ci.q('layout contents header contents _title ico').className = data.header.ico;
			
			ci.q('layout contents header contents').add('desc').txt(data.header.desc);
			ci.q('layout contents').add('info').txt('ci.contents.info');
			ci.q('layout contents').add('_progress').add('contents').txt('progress');
			
			ci.q('layout contents').add('footer').add('contents');
			ci.q('layout contents footer contents').htm(data.footer.company);
			
			ci.q('layout').add('navigator').add('header').add('ico').className = data.navigator.header.ico;
			ci.q('layout navigator header ico').id = 'icoNavHeader';
			setEvents( ci.q('layout navigator header ico') );
			ci.q('layout navigator header').add('contents');
			ci.q('layout navigator').add('contents').add('info').txt('navigator.contents.info');
			ci.q('layout navigator').add('footer').add('contents').txt('navigator.footer');
			*/
			
			// - Blast... - //
			// services.addQTestNavTree();
			
			setStyles();
		}

		function build() {
			addCi();
		}
		
		function init() {
			d = document, doc = d;
			d.title = data.header._title+' - '+data.header.desc;
			
			q=function( q ) { return d.querySelector( q ); };
			qs=function( q ) { return d.querySelectorAll( q ); };

			// - Hide document body - //
			d.body.style.display = 'none';
			
			Element.prototype.add = function(n) {
				if(typeof(n)== 'object') {
					this.appendChild( n ); 
					n.progen = this;
					return;
				}
				var cmp = d.createElement(n);
				if( cmp.nodeName != 'STYLE' ){ 
					cmp.className = 'cmp';
					with( cmp.style ) {
						if ( n != 'ico' ) {
							// display = 'block';
						}
					}
				}
				// - Store progenitor in child - //
				cmp.progen = this;
				return this.appendChild(cmp);
			};
			
			Element.prototype.q = function( q ) {
				return this.querySelector( q );
			};
			
			Element.prototype.qs = function( q ) {
				return this.querySelectorAll( q );
			};
			
			Element.prototype.clear = function() {
				this.textContent = '';
			};
			
			Element.prototype.show = function( ) {
				this.style.display = '';
			};
			
			Element.prototype.hide = function( ) {
				this.style.display = 'none';
			};
			
			Element.prototype.isDisplayed = function( ) {
				return this.style.display == '';
			};
			
			Element.prototype.txt = function( t ) {
				this.textContent = t;
			};	
			
			Element.prototype.htm = function( h ) {
				this.innerHTML = h;
			};			

			// - Build cI - //
			build();
		}
		
		var services = {
			addQTestNavTree: function() {
				var xhr = this.getXhr();
				xhr.onreadystatechange = function() {
				    if (this.readyState == 4 && this.status == 200) {
				    	var results = this.responseText;
				    	ci.q('layout navigator contents info').htm(results);
				    	
				    	// - Refurbish - //
				    	setStyleNavTree();
				    	
				    	// - Reveal - //
				    	ci.show();
				    }
				};
				xhr.open("GET", "/getExpandedNavTreeNodes", true);
				xhr.send();
			},
			getXhr: function() {
				return new XMLHttpRequest();
			}
		};
		
		function setStyleNavTree() {
			var ns = qs("[id*='test-design-tree'] [class*='tree-row removable']");
			[].forEach.call(ns, function( n ) {
				with(n.style) {
					cursor = 'pointer';
					// - Style root node - //
					if( rn = n.querySelector("[class*='root-node']") ) {
						// - Insert icon - //
						var ico = rn.insertBefore( doc.createElement('ico'), rn.firstChild );
						ico.className = 'fa fa-home';
						with( rn.style ) {
							fontWeight = 'bold';
							backgroundColor = 'hsl(180, 20%, 25%)';
							color = 'rgb(255,255,255)';
							padding = '9.797px';
							with(rn.querySelector('ico').style){
								// color = 'darkgreen';
								marginRight = '5px';
							}
						}
					}
					// - Hide object type element - //
					if(ot = n.querySelector("[class*='object-type']") ) {
						ot.style.display = 'none'; // - Hide object type indicator - //						
						// - Prepend object type icons - //
						var ico = ot.parentNode.insertBefore(doc.createElement('ico'), ot.nextSibling); 
						if(ot.textContent.indexOf('MD')>-1) {
							ico.className = 'fa fa-cogs module';
						} else if( ot.textContent.indexOf('TC')>-1) {
							ico.className = 'fa fa-cog testcase';
						}
						// - Style ot icons - //
						with(ico.style) {
							marginRight = '3px';
							if( ico.className.indexOf('module') > -1 ) {
								color = 'darkgreen';
							}else {
								color = 'lightgreen';
							}
						}						
						// - Style links - //
						if( a = n.querySelector('a') ) {
							with( a.style ) {
								textDecoration = 'none';
								color = 'rgb(0,0,0)';
							}
						}
					}
				}
				// - Tree node listener - //
				n.addEventListener('click', function(e) {
					var n = this.querySelector('a');
					!n ? n = this.querySelector('div') : null;
					if( n.className.indexOf('root-node') > -1 ) { return; }
					// - Query child nodes - //
					var ns = qs( '#'+n.id+'-children' );
					[].forEach.call(ns, function(n){
						with(n.style){
							display != 'none' ? display = 'none' : display = '';
						}
					});
				});
				// - Add navigator actions - //
				if( rn = n.querySelector("[class*='root-node']") ) {
					rn.style.display = 'flex';
					// - Refurbish - //
					var cn = doc.createElement('cn');
					[].forEach.call(rn.qs('*'), function(c) { cn.add( c ); });
					rn.add( cn );
					cn.style.flex = 1;
					// - Add actions container - //
					cn = rn.add( 'cn' );
					cn.id = 'cnNavActs';
					data.navigator.actions.forEach(function(o, i) {
						var ico = cn.add('ico');
						ico.id = o.id;
						ico.className = o.ico;
						ico.type = o.type;
						ico.title = o.desc;
						(o.id == 'expand_all') ? cn.add('sep').htm(data.actionSeparator) : null;
						with( ico.style ) {
							cursor = 'pointer';
							(ico.id == 'nav_search') ? marginLeft = '17px' : null;
						}
						setEvents(ico);
					});
					// - Fix nav tree root - //
					q('ci layout navigator').insertBefore(
							doc.createElement('cnRootNode'), q('ci layout navigator > contents'));
					q('ci layout navigator cnRootNode').add(rn.parentNode);
				}
			});		
		}
		
		function setEvents(o) {
			o.addEventListener('click', function(e) {
				if( o.type && o.type == 'nav_action' ) {
					if( o.id=='expand_all' || o.id == 'collapse_all' ) {
						expandCollapseNavTree(this);
					}
				}
				else if( o.id == 'icoNavHeader' ) {
					showHideNavigator();
				}
			});
		}
		
		function showHideNavigator() {
			var nav = q('ci navigator');
			// nav.isDisplayed() ? nav.hide() : nav.show();
			// nav.q('cnRootNode').hide();
			nav.q('contents > info').hide();
			nav.q('footer').hide();
			nav.style.width = '55px';
		}
		
		function expandCollapseNavTree(act) {
			var actId = act.id;
			var ns = qs("[id*='test-design-tree'] [class*='tree-row removable'] [class*='object-type-0']");
			[].forEach.call(ns, function(n){
				var id = n.parentNode.id+'-children';
				actId == 'expand_all' ? q( '#'+id ).style.display = '' : q( '#'+id ).style.display = 'none';
			});
		}
	</script>
</head>